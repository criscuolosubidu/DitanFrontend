# 调试指南：定位网络连接问题

## 问题现象

注册和登录都显示"无法连接到服务器，请检查网络或确保后端服务已启动"。

## 排查步骤

### 1. 打开浏览器开发者工具

1. 按 `F12` 打开开发者工具
2. 点击 `Console` 标签查看日志
3. 点击 `Network` 标签查看网络请求

### 2. 尝试登录/注册

1. 在登录页面输入用户名和密码
2. 点击登录按钮
3. **立即查看浏览器控制台**

### 3. 查看控制台日志

现在代码会自动打印详细的调试信息：

#### 成功的情况
```javascript
🚀 API Request: { method: 'POST', url: '/login', baseURL: '...', fullURL: '...' }
✅ API Response Success: { status: 200, data: {...} }
```

#### 失败的情况（网络错误）
```javascript
🚀 API Request: { method: 'POST', url: '/login', baseURL: '...', fullURL: '...' }
❌ API Error: { url: '/login', fullURL: 'https://...', message: '...' }
🌐 Network Error (No Response): { code: 'ECONNABORTED', message: 'timeout' }
💡 可能的原因：
  1. 后端服务未启动
  2. API地址错误
  3. CORS跨域问题
  4. 网络连接问题
  5. 防火墙阻止连接
```

#### 失败的情况（CORS跨域）
```javascript
🚀 API Request: { method: 'POST', url: '/login', ... }
❌ API Error: { message: 'Network Error', ... }
🌐 Network Error (No Response): { ... }
```

#### 失败的情况（404接口不存在）
```javascript
🚀 API Request: { method: 'POST', url: '/login', ... }
❌ API Error: { ... }
📊 Response Error Details: { status: 404, ... }
```

### 4. 查看Network标签

在 Network 标签中：

1. **找到登录请求**（通常以 `login` 命名）
2. **点击查看详情**
3. **查看以下信息**：

#### Headers 标签
- **Request URL**: 完整请求地址
- **Request Method**: POST
- **Request Headers**: 请求头信息
- **Response Headers**: 响应头信息

#### Preview/Response 标签
- 查看服务器返回的数据

#### 常见问题及状态码
- **红色请求** + `pending` → 请求未发送/网络问题
- **红色请求** + `(failed)` → 无法连接服务器
- **红色请求** + `CORS error` → 跨域问题
- **404** → 接口不存在
- **500** → 服务器错误
- **401** → 未授权（用户名密码错误）
- **400** → 请求参数错误

### 5. 快速验证API是否可用

打开浏览器开发者工具 Console，运行以下代码：

```javascript
// 测试注册接口
fetch('https://www.universalfuture.online/api/v1/doctor/register', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    username: 'test_user',
    name: '测试医生',
    password: '123456',
    gender: 'MALE',
    phone: '13800138000',
    department: '测试科室'
  })
})
.then(res => console.log('✅ 接口可以连接', res))
.catch(err => console.error('❌ 无法连接', err))
```

### 6. 使用curl命令测试（如果安装了）

在终端运行：

```bash
# 测试注册接口
curl -X POST https://www.universalfuture.online/api/v1/doctor/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "test_user",
    "name": "测试医生",
    "password": "123456",
    "gender": "MALE",
    "phone": "13800138000",
    "department": "测试科室"
  }'

# 测试登录接口
curl -X POST https://www.universalfuture.online/api/v1/doctor/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "test_user",
    "password": "123456"
  }'
```

## 常见问题及解决方案

### 问题1: CORS跨域错误

**现象**：
```
Access to fetch at '...' from origin 'http://localhost:5173' has been blocked by CORS policy
```

**解决方案**：
- 需要在后端配置CORS允许的源
- 或者在开发环境使用Vite代理

**使用Vite代理**（临时方案）：
修改 `vite.config.js`：

```javascript
export default {
  server: {
    proxy: {
      '/api': {
        target: 'https://www.universalfuture.online',
        changeOrigin: true,
        secure: true
      }
    }
  }
}
```

然后在 `src/api/auth.js` 修改为：
```javascript
const API_BASE_URL = '/api/v1/doctor'
```

### 问题2: 网络超时

**现象**：
```
timeout of 10000ms exceeded
```

**解决方案**：
- 增加超时时间（修改 `src/api/auth.js` 中的 `timeout`）
- 检查网络连接

### 问题3: 后端服务确实未启动

**现象**：
```
ERR_CONNECTION_REFUSED
```

**解决方案**：
- 联系后端开发者确认服务是否启动
- 确认API地址是否正确

### 问题4: SSL证书错误

**现象**：
```
ERR_CERT_INVALID
```

**解决方案**：
- 检查是否使用HTTPS
- 如果是内部测试环境，可能需要添加证书

### 问题5: 接口地址错误

**检查清单**：
1. ✅ 确认API地址：`https://www.universalfuture.online/api/v1/doctor`
2. ✅ 确认接口路径：`/register` 和 `/login`
3. ✅ 确认请求方法：`POST`
4. ✅ 确认Content-Type：`application/json`

## 使用Mock数据测试

如果后端暂时无法连接，可以使用Mock数据测试前端功能：

修改 `src/views/Login.vue` 和 `src/views/Register.vue`：

```javascript
// 从
import { loginDoctor } from '../api/auth'
// 改为
import { loginDoctor } from '../api/auth-mock'
```

## 完整调试检查清单

- [ ] 浏览器控制台是否有错误信息？
- [ ] Network标签中请求是否发送？
- [ ] 请求URL是否正确？
- [ ] 请求方法是否POST？
- [ ] Content-Type是否application/json？
- [ ] 是否有CORS错误？
- [ ] 是否有网络超时？
- [ ] 后端服务是否运行？
- [ ] 是否可以ping通服务器？
- [ ] 是否有防火墙阻止？
- [ ] API地址是否正确？

## 获取详细日志

修改 `src/api/auth.js` 中的超时时间（可选）：

```javascript
const apiClient = axios.create({
  baseURL: API_BASE_URL,
  timeout: 30000, // 改为30秒
  headers: {
    'Content-Type': 'application/json'
  }
})
```

## 联系支持

如果以上步骤都无法解决问题，请提供：

1. 浏览器控制台完整日志（截图）
2. Network标签中失败的请求详情（截图）
3. 使用的浏览器版本
4. 操作系统版本
5. 具体错误信息

