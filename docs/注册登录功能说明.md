# 注册登录功能说明

## 功能概述

已为项目添加完整的注册登录功能，包括路由管理、用户认证、API 调用等功能。

## 技术实现

### 1. 依赖包
- **Vue Router 4** - 用于路由管理
- **Axios** - 用于 HTTP 请求

### 2. 项目结构

```
src/
├── api/
│   └── auth.js          # 登录注册 API 接口
├── router/
│   └── index.js         # 路由配置
├── views/
│   ├── Login.vue        # 登录页面
│   ├── Register.vue     # 注册页面
│   └── Home.vue         # 主页（原有 ASR 功能）
├── App.vue              # 根组件（路由视图容器）
└── main.js              # 入口文件
```

## 功能特性

### 1. 路由管理
- **登录页** (`/login`) - 用户登录
- **注册页** (`/register`) - 新用户注册
- **首页** (`/`) - ASR 语音转写功能（需要登录）
- **路由守卫** - 未登录访问首页会跳转到登录页

### 2. 后端接口

#### 注册接口
- **URL**: `http://127.0.0.1:4523/m1/6768102-6480118-default/api/v1/doctor/register`
- **方法**: POST
- **请求体**: 
  ```json
  {
    "username": "用户名",
    "password": "密码",
    "doctorName": "医生姓名",
    "department": "科室"
  }
  ```

#### 登录接口
- **URL**: `http://127.0.0.1:4523/m1/6768102-6480118-default/api/v1/doctor/login`
- **方法**: GET
- **参数**: 
  ```
  ?username=用户名&password=密码
  ```

### 3. 登录状态管理

使用 **sessionStorage** 存储登录状态：
- `isAuthenticated`: 登录状态标记（`true`/`false`）
- `userInfo`: 用户信息 JSON 字符串

**注意**: 不使用 localStorage，页面刷新后需要重新登录。

### 4. 用户界面

#### 登录页面
- 用户名输入
- 密码输入
- 错误提示显示
- 注册页面跳转链接

#### 注册页面
- 用户名输入
- 密码输入（需确认）
- 医生姓名输入
- 科室输入
- 成功提示
- 登录页面跳转链接

#### 首页（ASR 功能）
- 左侧患者列表
- **新增用户信息栏**显示当前登录用户
- **退出登录按钮**，可退出并返回登录页

## 使用说明

### 1. 启动开发服务器

```bash
npm run dev
```

访问 `http://localhost:8000`（端口已改为 8000）

### 2. 注册新用户

1. 访问 `http://localhost:8000/login`
2. 点击"立即注册"链接
3. 填写注册信息：
   - 用户名（必填）
   - 密码（至少 6 位，必填）
   - 确认密码（必填）
   - 医生姓名（必填）
   - 科室（可选）
4. 点击"注册"按钮
5. 注册成功后自动跳转到登录页

### 3. 登录

1. 在登录页输入用户名和密码
2. 点击"登录"按钮
3. 登录成功后跳转到首页
4. 首页显示用户信息栏和退出登录按钮

### 4. 退出登录

1. 点击首页左上角用户信息栏的"退出"按钮
2. 确认后清除登录状态并跳转到登录页

### 5. 路由守卫

- 未登录用户访问首页会自动跳转到登录页
- 已登录用户访问登录/注册页会自动跳转到首页
- 访问不存在的路由会跳转到登录页

## 代码说明

### API 配置 (`src/api/auth.js`)

```javascript
// 创建 axios 实例
const apiClient = axios.create({
  baseURL: 'http://127.0.0.1:4523/m1/6768102-6480118-default/api/v1/doctor',
  timeout: 10000
})

// 注册接口
export const registerDoctor = (userData) => {
  return apiClient.post('/register', userData)
}

// 登录接口
export const loginDoctor = (credentials) => {
  return apiClient.get('/login', { params: credentials })
}
```

### 路由配置 (`src/router/index.js`)

```javascript
// 路由守卫
router.beforeEach((to, from, next) => {
  const isAuthenticated = sessionStorage.getItem('isAuthenticated') === 'true'
  
  if (to.meta.requiresAuth && !isAuthenticated) {
    next('/login')
  } else if ((to.path === '/login' || to.path === '/register') && isAuthenticated) {
    next('/')
  } else {
    next()
  }
})
```

## 注意事项

1. **端口配置**: 开发服务器运行在端口 8000（在 `vite.config.js` 中配置）
2. **后端接口**: 确保后端服务在 `http://127.0.0.1:4523` 运行
3. **登录状态**: 使用 sessionStorage，页面刷新后需重新登录
4. **CORS**: 如果遇到跨域问题，需要后端配置 CORS 支持

## 自定义

### 修改后端接口地址

编辑 `src/api/auth.js`:

```javascript
const API_BASE_URL = '你的后端地址/api/v1/doctor'
```

### 修改端口

编辑 `vite.config.js`:

```javascript
server: {
  port: 8000  // 改为你需要的端口
}
```

## 测试

1. 测试注册功能：填写完整信息并提交
2. 测试登录功能：使用注册的用户名密码登录
3. 测试路由守卫：未登录访问首页应跳转到登录页
4. 测试退出登录：退出后应清除登录状态并跳转到登录页

