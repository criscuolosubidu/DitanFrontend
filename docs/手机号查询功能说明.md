# 手机号查询功能说明

## 功能概述

新增了通过手机号查询患者信息的功能，与扫描二维码功能功能类似，可以将查询到的患者信息添加到左侧患者列表。

## 功能特点

- ✅ 通过手机号快速查询患者信息
- ✅ 支持11位手机号格式验证
- ✅ 查询结果自动添加到患者列表
- ✅ 与扫描二维码功能使用相同的数据显示格式
- ✅ 完善的错误处理和用户提示

## 使用方法

### 1. 点击"输入手机号"按钮

在主界面点击绿色的"📞 输入手机号"按钮。

### 2. 输入手机号

在弹出的输入框中输入11位手机号，例如：
```
13800138000
```

### 3. 点击"查询"按钮

系统会自动：
- 验证手机号格式
- 调用后端API查询患者信息
- 将查询结果添加到左侧患者列表
- 显示成功提示

## API接口

### 查询接口

- **URL**: `https://www.universalfuture.online/api/v1/patient/query`
- **方法**: POST
- **Content-Type**: application/json

#### 请求体格式

```json
{
  "phone": "13800138000"
}
```

#### 字段说明

- `phone` (必填): 手机号，必须是11位数字

#### 响应格式

```json
{
  "success": true,
  "data": {
    "cardNumber": "1234567890",
    "name": "张三",
    "phone": "13800138000",
    "gender": "男",
    "birthDate": "1990-01-01",
    "height": "175",
    "weight": "70",
    "target": "65"
  }
}
```

## 代码实现

### API接口文件

创建了 `src/api/patient.js` 用于患者查询API：

```javascript
import axios from 'axios'

const API_BASE_URL = import.meta.env.DEV
  ? '/api/v1/patient'
  : 'https://www.universalfuture.online/api/v1/patient'

const apiClient = axios.create({
  baseURL: API_BASE_URL,
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json'
  }
})

export const queryPatientByPhone = (queryData) => {
  return apiClient.post('/query', queryData)
}
```

### 主要功能

#### 1. 手机号验证

- 检查是否为空
- 检查长度是否为11位
- 检查是否只包含数字

#### 2. 查询患者

```javascript
const queryPatientByPhone = async () => {
  // 1. 验证手机号格式
  if (phoneInput.value.length !== 11) {
    queryError.value = '手机号必须是11位数字'
    return
  }
  
  // 2. 调用API
  const response = await queryPatientAPI({ phone: phoneInput.value })
  
  // 3. 处理响应
  const patient = response.data.data
  
  // 4. 添加到患者列表
  addPatient(patient)
  
  // 5. 显示成功提示
  showSuccessMessage(`成功查询并添加患者: ${patient.name}`)
}
```

#### 3. 错误处理

系统能够处理以下错误情况：

- **验证错误**：手机号格式不正确
- **404错误**：未找到该患者信息
- **400错误**：请求参数错误
- **500错误**：服务器错误
- **网络错误**：无法连接到服务器

## 与扫描二维码功能的对比

| 功能 | 扫描二维码 | 输入手机号 |
|------|-----------|-----------|
| 输入方式 | 摄像头扫描 | 手动输入 |
| 数据来源 | 二维码内容 | 后端API查询 |
| 添加方式 | 解析二维码 | 调用查询接口 |
| 显示效果 | ✅ 相同 | ✅ 相同 |
| 左侧列表 | ✅ 一致 | ✅ 一致 |

## 跨域问题

项目已经配置了Vite代理来解决CORS跨域问题：

### 配置位置

`vite.config.js`:

```javascript
proxy: {
  '/api': {
    target: 'https://www.universalfuture.online',
    changeOrigin: true,
    secure: true
  }
}
```

### 工作原理

```
浏览器请求: POST http://localhost:8000/api/v1/patient/query
         ↓ (Vite代理转发)
实际请求: POST https://www.universalfuture.online/api/v1/patient/query
```

## 使用示例

### 完整的查询流程

1. **打开查询弹窗**
   ```javascript
   openPhoneInput()  // 点击"输入手机号"按钮
   ```

2. **输入手机号**
   ```
   13800138000
   ```

3. **点击查询**
   ```javascript
   queryPatientByPhone()  // 验证并查询
   ```

4. **添加到列表**
   ```javascript
   addPatient(patient)  // 自动添加到左侧患者列表
   ```

5. **查看患者详情**
   点击左侧患者列表中的患者，查看详细信息

## 注意事项

1. **手机号格式**：必须是11位数字
2. **网络连接**：确保后端服务正常运行
3. **数据完整性**：查询结果取决于后端返回的数据
4. **重复患者**：如果已存在相同卡号的患者，会更新而不是添加新记录

## 错误提示

系统会显示清晰的错误提示：

| 错误情况 | 提示信息 |
|---------|---------|
| 手机号为空 | "请输入手机号" |
| 手机号长度不对 | "手机号必须是11位数字" |
| 包含非数字 | "手机号只能包含数字" |
| 未找到患者 | "未找到该患者信息" |
| 网络错误 | "无法连接到服务器，请检查网络或确保后端服务已启动" |
| 服务器错误 | "服务器错误，请稍后再试" |

## 后续优化建议

1. 添加手机号历史记录
2. 支持手机号自动补全
3. 添加快捷搜索功能
4. 支持批量查询
5. 添加查询结果缓存


